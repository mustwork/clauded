---
# Install MongoDB tools on Ubuntu
# MongoDB database-tools provide mongodump, mongorestore, etc.

- name: Install prerequisites for MongoDB tools
  apt:
    name:
      - curl
      - gnupg
    state: present
    update_cache: yes

- name: Add MongoDB GPG key
  shell: |
    curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | gpg --dearmor -o /usr/share/keyrings/mongodb-server-7.0.gpg
  args:
    creates: /usr/share/keyrings/mongodb-server-7.0.gpg

- name: Add MongoDB repository
  apt_repository:
    repo: "deb [arch=arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse"
    state: present
    filename: mongodb-org-7.0

- name: Install MongoDB database tools
  apt:
    name: mongodb-database-tools
    state: present
    update_cache: yes

- name: Verify mongodump installation
  command: mongodump --version
  register: mongodump_version
  changed_when: false
  failed_when: false

- name: Display mongodump version
  debug:
    msg: "mongodump version: {{ mongodump_version.stdout | default('unknown') }}"
