---
# Install base Python tools for system compatibility
# The uv role will install the specific Python version requested by the user

- name: Install Python build dependencies
  apk:
    name:
      - python3
      - python3-dev
      - py3-pip
      - py3-virtualenv
      # Build dependencies for compiling Python from source
      - build-base
      - libffi-dev
      - openssl-dev
      - zlib-dev
      - readline-dev
      - bzip2-dev
      - xz-dev
      - sqlite-dev
      - ncurses-dev
    state: present
    update_cache: yes

- name: Install pipx via pip
  pip:
    name: pipx
    executable: pip3
    extra_args: --break-system-packages

- name: Ensure pipx path is configured
  shell: pipx ensurepath
  changed_when: false
  ignore_errors: yes

- name: Display system Python version
  command: python3 --version
  register: system_python_output
  changed_when: false

- name: Note system Python
  debug:
    msg: "System Python: {{ system_python_output.stdout }} (uv will install Python {{ python_version }})"
