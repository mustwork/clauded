---
- name: Install Claude Code CLI
  npm:
    name: "@anthropic-ai/claude-code"
    global: yes

- name: Create Claude Code settings directory
  file:
    path: ~/.claude
    state: directory
    mode: '0755'
  become: no
  when: claude_dangerously_skip_permissions | default(false)

- name: Configure Claude Code auto-accept permissions
  copy:
    dest: ~/.claude/settings.json
    content: |
      {
        "permissions": {
          "allow": [
            "Bash(*)",
            "Read(*)",
            "Write(*)",
            "Edit(*)",
            "WebFetch(*)",
            "Grep(*)",
            "Glob(*)"
          ]
        }
      }
    mode: '0644'
  become: no
  when: claude_dangerously_skip_permissions | default(false)

- name: Verify Claude Code installation
  command: claude --version
  register: claude_version
  changed_when: false
  ignore_errors: yes

- name: Display Claude Code version
  debug:
    msg: "Claude Code version: {{ claude_version.stdout | default('installed') }}"
